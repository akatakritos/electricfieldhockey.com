//Electric Field Hockey.js
!function(a){var b=a.EFH||{};"undefined"==typeof a.EFH&&(a.EFH=b);var c=function(a,b){if(b)for(var c in b)a.hasOwnProperty(c)&&(a[c]=b[c])},d=function(a){this.magnitude=0,this.direction=0,c(this,a)};d.prototype.toString=function(){return"Vector: "+this.magnitude.toFixed(2)+" @ "+(180*this.direction/Math.PI).toFixed(2)},d.prototype.add=function(a){if(0===a.magnitude)return new d({magnitude:this.magnitude,direction:this.direction});var b=this.xComponent()+a.xComponent(),c=this.yComponent()+a.yComponent(),e=Math.atan2(c,b),f=Math.sqrt(b*b+c*c);return new d({magnitude:f,direction:e}).standardize()},d.prototype.mult=function(a){return new d({magnitude:this.magnitude*a,direction:this.direction}).standardize()},d.prototype.xComponent=function(){return this.magnitude*Math.cos(this.direction)},d.prototype.yComponent=function(){return this.magnitude*Math.sin(this.direction)},d.ZERO=new d({magnitude:0,direction:0}),d.prototype.standardize=function(){var a=this.direction,b=this.magnitude;0>b&&(b=Math.abs(b),a+=Math.PI);for(var c=0>a?2*Math.PI:-2*Math.PI;0>a||a>2*Math.PI;)a+=c;var e=new d({magnitude:b,direction:a});return e.nonstandard=this,e},d.fromComponent=function(a,b){return new d({magnitude:Math.sqrt(a*a+b*b),direction:Math.atan2(b,a)}).standardize()},b.Vector=d;var e=1e6,f=function(a){this.x=0,this.y=0,this.charge=1,c(this,a)};f.prototype.calcForceAgainst=function(a){var b=a.x-this.x,c=a.y-this.y,f=Math.sqrt(b*b+c*c),g=Math.atan2(c,b),h=e*this.charge*a.charge/(f*f);return h==Number.POSITIVE_INFINITY&&(h=Number.MAX_VALUE),new d({magnitude:h,direction:g}).standardize()},f.prototype.calcForceFrom=function(a){var b=this;return 0===a.length?d.ZERO:a.map(function(a){return a.calcForceAgainst(b)}).reduce(function(a,b){return a.add(b)},d.ZERO).standardize()},b.PointCharge=f,b.K=e;var g={};g.calcPosition=function(a,b,c,d){return{x:a.x+(b.xComponent()*d+c.xComponent()*d*d),y:a.y+(b.yComponent()*d+c.yComponent()*d*d)}},g.calcVelocity=function(a,b,c){return a.add(b.mult(c))},b.Physics=g;var h=function(a,b){this.charges=[],this.initialState=a,this.currentState=a,this.previousState=a,this.accumulator=0,this.simrate=1e3/60,this.onStep=b||function(){}};h.prototype.reset=function(){this.currentState=this.previousState=this.initialState,this.accumulator=0},h.prototype.step=function(a,b){var c=b/1e3;if(0===c)return a;var d=new f({x:a.position.x,y:a.position.y,charge:a.charge.charge}).calcForceFrom(this.charges),e=g.calcPosition(a.position,a.velocity,d,c),h=d,i=g.calcVelocity(a.velocity,d,c);return{position:e,velocity:i,acceleration:h,charge:a.charge}},h.prototype.handleFrameRequest=function(a){var b=a.timeDiff>250?250:a.timeDiff;for(this.accumulator+=b;this.accumulator>=this.simrate;)this.previousState=this.currentState,this.currentState=this.step(this.currentState,this.simrate),this.accumulator-=this.simrate,this.onStep(this.currentState,a);var c=this.accumulator/b,d=this.blend(this.previousState,this.currentState,c);return d},h.prototype.blend=function(a,b,c){var e=d.fromComponent(a.position.x,a.position.y),f=d.fromComponent(b.position.x,b.position.y),g=f.mult(c).add(e.mult(1-c));return{velocity:b.velocity,acceleration:b.acceleration,position:{x:g.xComponent(),y:g.yComponent()}}},h.prototype.addToPlayingField=function(a){-1===this.charges.indexOf(a)&&this.charges.push(a)},h.prototype.removeFromPlayingField=function(a){var b=this.charges.indexOf(a);b>-1&&this.charges.splice(b,1)},b.Simulation=h}("undefined"==typeof window?global:window);